# 关于双花
注意：本文省略了大部分单元有效性验证和UTXO有效性验证内容，仅用于说明双花的生成条件和超级节点的安全保护方法。

## UTXO验证
某节点接收到交易单元后，解析单元的message，进而获得input的UTXO来源，并在已经稳定的账本中查找该UTXO是否存在并有效。若有效则接收该单元，否则拒绝接收。

## 生成双花的条件
某节点在两个不同的单元中使用了相同的UTXO，并且同时广播到P2P网络中，这两个单元可能都会被接收，并会在它们变成稳定状态前被识别成双花。生成双花单元的节点会被标记成恶意节点。
生成双花的条件：
1)	钱包地址中存在有效的UTXO；
2)	使用相同UTXO生成两个不同的单元；
3)	同时广播双花单元，使它们同时存在于账本的非稳定区。

## 双花的影响
- 对于有抵押的超级节点：
  - 超级节点地址永久进入黑名单，不再允许参与公证人竞选。
  - 若该超级节点成功当选公证人，那么超级节点押金会被锁定21天。锁定期后，可以取出押金重新部署超级节点。
  - 禁止交易1小时
- 对于无抵押的超级节点：
  - 超级节点地址永久进入黑名单，不再允许参与公证人竞选。
  - 禁止交易1小时
- 对于有抵押的普通用户：
  - 钱包地址永久进入黑名单，不再发放抵押收益。
  - 禁止交易1小时
- 对于无抵押的普通用户：
  - 禁止交易1小时

## 超级节点如何避免双花
- 加强超级节点的网络安全防护，避免私钥泄漏或程序被篡改。
- 尽量保证超级节点在运行期间钱包余额为零。
  - PoW单元、TrustME单元和Coinbase单元都是特殊单元，有严格验证和去重机制，不会出现双花。
  - 特殊单元没有交易手续费，超级节点仅在生成押金合约时需要钱包内有少量余额，挖矿过程中钱包内不需要有余额。

